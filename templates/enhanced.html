<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Trading System - Enhanced Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/enhanced.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="app-title">
                        <i class="bi bi-robot"></i>
                        Personal Trading System
                    </h1>
                    <div class="mode-badge" id="currentModeBadge">
                        <span class="mode-icon">‚óè</span>
                        <span id="currentEnvironmentText">Simulation</span>
                        <span class="mode-separator">|</span>
                        <span id="currentAutomationText">Manual</span>
                    </div>
                </div>
                <div class="header-right">
                    <button class="btn-icon" id="notificationBtn" title="Notifications">
                        <i class="bi bi-bell"></i>
                        <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                    </button>
                    <button class="btn-icon" id="refreshBtn" title="Refresh">
                        <i class="bi bi-arrow-clockwise"></i>
                    </button>
                    <button class="btn-emergency" id="emergencyStopBtn" title="Emergency Stop All">
                        <i class="bi bi-octagon-fill"></i>
                        STOP
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="app-nav">
            <button class="nav-btn active" data-page="dashboard">
                <i class="bi bi-speedometer2"></i>
                <span>Dashboard</span>
            </button>
            <button class="nav-btn" data-page="models">
                <i class="bi bi-cpu"></i>
                <span>Models</span>
            </button>
            <button class="nav-btn" data-page="settings">
                <i class="bi bi-sliders"></i>
                <span>Settings</span>
            </button>
            <button class="nav-btn" data-page="readiness">
                <i class="bi bi-check-circle"></i>
                <span>Readiness</span>
            </button>
            <button class="nav-btn" data-page="incidents">
                <i class="bi bi-exclamation-triangle"></i>
                <span>Incidents</span>
            </button>
            <a href="/classic" class="nav-btn">
                <i class="bi bi-grid"></i>
                <span>Classic View</span>
            </a>
        </nav>

        <!-- Notification Panel -->
        <div class="notification-panel" id="notificationPanel">
            <div class="notification-panel-header">
                <h3><i class="bi bi-bell"></i> Notifications</h3>
                <div class="notification-panel-actions">
                    <button class="btn-text" id="clearAllNotificationsBtn">Clear All</button>
                    <button class="btn-icon" id="closeNotificationPanelBtn">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
            </div>
            <div class="notification-panel-content" id="notificationList">
                <div class="empty-state">
                    <i class="bi bi-bell-slash"></i>
                    <p>No notifications yet</p>
                </div>
            </div>
        </div>

        <!-- Notification Overlay -->
        <div class="notification-overlay" id="notificationOverlay"></div>

        <!-- Page: Dashboard -->
        <div class="page active" id="dashboardPage">
            <!-- Model Selector -->
            <div class="section">
                <div class="section-header">
                    <h2>Select Model</h2>
                </div>
                <div class="model-selector">
                    <select id="modelSelect" class="form-select">
                        <option value="">Loading models...</option>
                    </select>
                    <button id="showAllModelsBtn" class="btn-secondary" style="margin-left: 10px;">
                        <i class="bi bi-grid-3x3"></i> Show All Models
                    </button>
                    <button id="showSingleModelBtn" class="btn-secondary" style="margin-left: 10px; display: none;">
                        <i class="bi bi-graph-up"></i> Show Single Model
                    </button>
                </div>
            </div>

            <!-- Market Prices Ticker -->
            <div class="market-ticker-container">
                <div class="market-ticker" id="marketTicker">
                    <div class="ticker-item">Loading market data...</div>
                </div>
            </div>

            <!-- Portfolio Overview - Hero Section -->
            <div class="section">
                <div class="section-header">
                    <h2>üìä Portfolio Overview</h2>
                </div>
                <div class="portfolio-metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Total Value</div>
                        <div class="metric-value" id="totalValue">$0.00</div>
                        <div class="metric-change" id="totalValueChange">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Total P&L</div>
                        <div class="metric-value" id="totalPnL">$0.00</div>
                        <div class="metric-change" id="totalPnLPercent">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Today's P&L</div>
                        <div class="metric-value" id="todayPnL">$0.00</div>
                        <div class="metric-change" id="todayPnLPercent">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Win Rate</div>
                        <div class="metric-value" id="winRate">0%</div>
                        <div class="metric-subtitle" id="winRateDetails">0 wins / 0 trades</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Total Trades</div>
                        <div class="metric-value" id="totalTrades">0</div>
                        <div class="metric-subtitle" id="tradesBreakdown">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Open Positions</div>
                        <div class="metric-value" id="openPositionsCount">0</div>
                        <div class="metric-subtitle" id="positionsValue">$0.00</div>
                    </div>
                </div>
            </div>

            <!-- Portfolio Value Chart -->
            <div class="section">
                <div class="section-header">
                    <h2>Portfolio Value Over Time</h2>
                    <div class="chart-controls">
                        <button class="time-range-btn active" data-range="24h">24H</button>
                        <button class="time-range-btn" data-range="7d">7D</button>
                        <button class="time-range-btn" data-range="30d">30D</button>
                        <button class="time-range-btn" data-range="90d">90D</button>
                        <button class="time-range-btn" data-range="all">ALL</button>
                    </div>
                </div>
                <div class="chart-container">
                    <div id="portfolioChart" style="width: 100%; height: 400px;"></div>
                </div>
            </div>

            <!-- Asset Allocation & Performance Analytics -->
            <div class="section">
                <div class="analytics-grid">
                    <!-- Asset Allocation Donut Chart -->
                    <div class="analytics-card">
                        <div class="analytics-card-header">
                            <h3>ü•ß Asset Allocation</h3>
                            <div class="analytics-info">
                                <span id="allocationTimestamp">--</span>
                            </div>
                        </div>
                        <div class="chart-container">
                            <div id="assetAllocationChart" style="width: 100%; height: 350px;"></div>
                        </div>
                        <div class="allocation-legend" id="allocationLegend">
                            <!-- Legend items will be added dynamically -->
                        </div>
                    </div>

                    <!-- Performance Metrics -->
                    <div class="analytics-card">
                        <div class="analytics-card-header">
                            <h3>üìà Performance Analytics</h3>
                            <div class="analytics-info">
                                <button class="btn-secondary btn-small" id="exportReportBtn" style="margin-right: 8px;">
                                    <i class="bi bi-file-earmark-text"></i> Export Report
                                </button>
                                <button class="btn-icon" id="refreshAnalyticsBtn" title="Refresh Analytics">
                                    <i class="bi bi-arrow-clockwise"></i>
                                </button>
                            </div>
                        </div>
                        <div class="performance-metrics-grid">
                            <div class="perf-metric-card">
                                <div class="perf-metric-icon">üìä</div>
                                <div class="perf-metric-content">
                                    <div class="perf-metric-label">Sharpe Ratio</div>
                                    <div class="perf-metric-value" id="sharpeRatio">--</div>
                                    <div class="perf-metric-desc">Risk-adjusted return</div>
                                </div>
                            </div>
                            <div class="perf-metric-card">
                                <div class="perf-metric-icon">üìâ</div>
                                <div class="perf-metric-content">
                                    <div class="perf-metric-label">Max Drawdown</div>
                                    <div class="perf-metric-value" id="maxDrawdown">--</div>
                                    <div class="perf-metric-desc">Peak to trough decline</div>
                                </div>
                            </div>
                            <div class="perf-metric-card">
                                <div class="perf-metric-icon">üî•</div>
                                <div class="perf-metric-content">
                                    <div class="perf-metric-label">Win Streak</div>
                                    <div class="perf-metric-value" id="winStreak">--</div>
                                    <div class="perf-metric-desc">Consecutive wins</div>
                                </div>
                            </div>
                            <div class="perf-metric-card">
                                <div class="perf-metric-icon">‚ùÑÔ∏è</div>
                                <div class="perf-metric-content">
                                    <div class="perf-metric-label">Loss Streak</div>
                                    <div class="perf-metric-value" id="lossStreak">--</div>
                                    <div class="perf-metric-desc">Consecutive losses</div>
                                </div>
                            </div>
                            <div class="perf-metric-card">
                                <div class="perf-metric-icon">üèÜ</div>
                                <div class="perf-metric-content">
                                    <div class="perf-metric-label">Best Trade</div>
                                    <div class="perf-metric-value" id="bestTrade">--</div>
                                    <div class="perf-metric-desc">Highest P&L</div>
                                </div>
                            </div>
                            <div class="perf-metric-card">
                                <div class="perf-metric-icon">üíî</div>
                                <div class="perf-metric-content">
                                    <div class="perf-metric-label">Worst Trade</div>
                                    <div class="perf-metric-value" id="worstTrade">--</div>
                                    <div class="perf-metric-desc">Lowest P&L</div>
                                </div>
                            </div>
                            <div class="perf-metric-card">
                                <div class="perf-metric-icon">üí∞</div>
                                <div class="perf-metric-content">
                                    <div class="perf-metric-label">Avg Win</div>
                                    <div class="perf-metric-value" id="avgWin">--</div>
                                    <div class="perf-metric-desc">Mean winning trade</div>
                                </div>
                            </div>
                            <div class="perf-metric-card">
                                <div class="perf-metric-icon">üí∏</div>
                                <div class="perf-metric-content">
                                    <div class="perf-metric-label">Avg Loss</div>
                                    <div class="perf-metric-value" id="avgLoss">--</div>
                                    <div class="perf-metric-desc">Mean losing trade</div>
                                </div>
                            </div>
                            <div class="perf-metric-card">
                                <div class="perf-metric-icon">‚öñÔ∏è</div>
                                <div class="perf-metric-content">
                                    <div class="perf-metric-label">Profit Factor</div>
                                    <div class="perf-metric-value" id="profitFactor">--</div>
                                    <div class="perf-metric-desc">Wins / Losses ratio</div>
                                </div>
                            </div>
                            <div class="perf-metric-card">
                                <div class="perf-metric-icon">üéØ</div>
                                <div class="perf-metric-content">
                                    <div class="perf-metric-label">Win Rate</div>
                                    <div class="perf-metric-value" id="winRate">--</div>
                                    <div class="perf-metric-desc">Profitable trades %</div>
                                </div>
                            </div>
                            <div class="perf-metric-card">
                                <div class="perf-metric-icon">üíé</div>
                                <div class="perf-metric-content">
                                    <div class="perf-metric-label">Total Return</div>
                                    <div class="perf-metric-value" id="totalReturn">--</div>
                                    <div class="perf-metric-desc">Overall profit/loss</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Two Column Layout: Positions & Trade History -->
            <div class="section">
                <div class="dashboard-two-column">
                    <!-- Left Column: Tables -->
                    <div class="dashboard-left">
                        <!-- Current Positions -->
                        <div class="data-section">
                            <div class="section-header">
                                <h3>üìà Current Positions</h3>
                                <div class="header-actions">
                                    <button class="btn-secondary btn-small" id="exportPositionsBtn">
                                        <i class="bi bi-download"></i> Export
                                    </button>
                                </div>
                            </div>
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Coin</th>
                                            <th>Amount</th>
                                            <th>Avg Buy</th>
                                            <th>Current</th>
                                            <th>P&L</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="positionsTableBody">
                                        <tr><td colspan="6" class="empty-state">No open positions</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Trade History -->
                        <div class="data-section">
                            <div class="section-header">
                                <h3>üìú Trade History</h3>
                                <div class="header-actions">
                                    <button class="btn-secondary btn-small" id="exportTradesBtn">
                                        <i class="bi bi-download"></i> Export
                                    </button>
                                </div>
                            </div>
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Coin</th>
                                            <th>Action</th>
                                            <th>Amount</th>
                                            <th>Price</th>
                                            <th>P&L</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tradesTableBody">
                                        <tr><td colspan="6" class="empty-state">No trades yet</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="table-pagination" id="tradesPagination">
                                <button class="btn-secondary btn-small" id="prevPageBtn">‚Üê Previous</button>
                                <span class="pagination-info" id="paginationInfo">Page 1 of 1</span>
                                <button class="btn-secondary btn-small" id="nextPageBtn">Next ‚Üí</button>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Risk & Decisions -->
                    <div class="dashboard-right">
                        <!-- Risk Status (moved from below) -->
                        <div class="data-section">
                            <div class="section-header">
                                <h3>Risk Status</h3>
                            </div>
                            <div class="risk-grid-compact" id="riskGridCompact">
                                <div class="risk-card-compact">
                                    <div class="risk-label">Position Size</div>
                                    <div class="risk-value" id="riskPositionSize">--</div>
                                    <div class="risk-progress-bar">
                                        <div class="risk-progress-fill" id="progressPositionSize"></div>
                                    </div>
                                    <div class="risk-status status-ok" id="statusPositionSize">OK</div>
                                </div>
                                <div class="risk-card-compact">
                                    <div class="risk-label">Daily Loss</div>
                                    <div class="risk-value" id="riskDailyLoss">--</div>
                                    <div class="risk-progress-bar">
                                        <div class="risk-progress-fill" id="progressDailyLoss"></div>
                                    </div>
                                    <div class="risk-status status-ok" id="statusDailyLoss">OK</div>
                                </div>
                                <div class="risk-card-compact">
                                    <div class="risk-label">Open Positions</div>
                                    <div class="risk-value" id="riskOpenPositions">--</div>
                                    <div class="risk-progress-bar">
                                        <div class="risk-progress-fill" id="progressOpenPositions"></div>
                                    </div>
                                    <div class="risk-status status-ok" id="statusOpenPositions">OK</div>
                                </div>
                                <div class="risk-card-compact">
                                    <div class="risk-label">Cash Reserve</div>
                                    <div class="risk-value" id="riskCashReserve">--</div>
                                    <div class="risk-progress-bar">
                                        <div class="risk-progress-fill" id="progressCashReserve"></div>
                                    </div>
                                    <div class="risk-status status-ok" id="statusCashReserve">OK</div>
                                </div>
                                <div class="risk-card-compact">
                                    <div class="risk-label">Daily Trades</div>
                                    <div class="risk-value" id="riskDailyTrades">--</div>
                                    <div class="risk-progress-bar">
                                        <div class="risk-progress-fill" id="progressDailyTrades"></div>
                                    </div>
                                    <div class="risk-status status-ok" id="statusDailyTrades">OK</div>
                                </div>
                            </div>
                        </div>

                        <!-- Decision History (Enhanced with tabs) -->
                        <div class="data-section">
                            <div class="section-header">
                                <h3>ü§ñ Decision History</h3>
                                <span class="badge" id="pendingCount">0</span>
                            </div>

                            <!-- Decision Tabs -->
                            <div class="decision-tabs">
                                <button class="decision-tab active" data-status="pending">
                                    <i class="bi bi-clock-history"></i> Pending
                                </button>
                                <button class="decision-tab" data-status="approved">
                                    <i class="bi bi-check-circle"></i> Approved
                                </button>
                                <button class="decision-tab" data-status="rejected">
                                    <i class="bi bi-x-circle"></i> Rejected
                                </button>
                                <button class="decision-tab" data-status="expired">
                                    <i class="bi bi-stopwatch"></i> Expired
                                </button>
                                <button class="decision-tab" data-status="all">
                                    <i class="bi bi-list"></i> All
                                </button>
                            </div>

                            <!-- Decision Container -->
                            <div id="pendingDecisionsContainer" class="decisions-container">
                                <div class="empty-state">
                                    <i class="bi bi-inbox"></i>
                                    <p>No decisions yet</p>
                                </div>
                            </div>
                        </div>

                        <!-- AI Conversations (NEW) -->
                        <div class="data-section">
                            <div class="section-header">
                                <h3>üí¨ AI Conversations</h3>
                                <button class="btn-icon" id="toggleConversations">
                                    <i class="bi bi-chevron-down"></i>
                                </button>
                            </div>
                            <!-- Conversation Controls -->
                            <div class="conversation-controls">
                                <div class="conversation-search">
                                    <i class="bi bi-search"></i>
                                    <input type="text" id="conversationSearch" placeholder="Search conversations..." class="search-input">
                                </div>
                                <div class="conversation-filters">
                                    <select id="conversationFilter" class="filter-select">
                                        <option value="all">All</option>
                                        <option value="buy">Buy</option>
                                        <option value="sell">Sell</option>
                                        <option value="hold">Hold</option>
                                    </select>
                                    <select id="conversationSort" class="filter-select">
                                        <option value="newest">Newest First</option>
                                        <option value="oldest">Oldest First</option>
                                    </select>
                                </div>
                            </div>
                            <div id="conversationsContainer" class="conversations-container">
                                <div class="empty-state">
                                    <i class="bi bi-chat-dots"></i>
                                    <p>No conversations yet</p>
                                </div>
                            </div>
                        </div>

                        <!-- Live Activity Feed -->
                        <div class="data-section">
                            <div class="section-header">
                                <h3>üìä Live Activity</h3>
                                <button class="btn-icon" id="clearActivityBtn" title="Clear Activity">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                            <div id="activityFeedContainer" class="activity-feed-container">
                                <div class="empty-state">
                                    <i class="bi bi-activity"></i>
                                    <p>No recent activity</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions (moved up, before trading settings) -->
            <div class="section">
                <div class="section-header">
                    <h2>Quick Actions</h2>
                </div>
                <div class="action-buttons">
                    <button class="btn-primary" id="executeTradingBtn">
                        <i class="bi bi-play-circle"></i>
                        Execute Trading Cycle
                    </button>
                    <button class="btn-secondary" id="pauseModelBtn">
                        <i class="bi bi-pause-circle"></i>
                        Emergency Pause
                    </button>
                </div>
            </div>

            <!-- Trading Environment -->
            <div class="section">
                <div class="section-header">
                    <h2>Trading Environment</h2>
                    <span class="help-icon" title="WHERE trades are executed - simulation or live exchange">
                        <i class="bi bi-question-circle"></i>
                    </span>
                </div>
                <div class="mode-control">
                    <div class="mode-option" data-environment="simulation">
                        <input type="radio" name="environment" id="envSimulation" value="simulation">
                        <label for="envSimulation">
                            <div class="mode-title">
                                <i class="bi bi-laptop"></i>
                                Simulation (Paper Trading)
                            </div>
                            <div class="mode-desc">Practice with virtual money. Database only, no real exchange API calls.</div>
                        </label>
                    </div>
                    <div class="mode-option" data-environment="live">
                        <input type="radio" name="environment" id="envLive" value="live">
                        <label for="envLive">
                            <div class="mode-title">
                                <i class="bi bi-broadcast"></i>
                                Live Trading
                            </div>
                            <div class="mode-desc">‚ö†Ô∏è REAL MONEY - Executes on real exchange (testnet or mainnet).</div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Automation Level -->
            <div class="section">
                <div class="section-header">
                    <h2>Automation Level</h2>
                    <span class="help-icon" title="HOW much control you have - manual, semi-auto, or full-auto">
                        <i class="bi bi-question-circle"></i>
                    </span>
                </div>
                <div class="mode-control">
                    <div class="mode-option" data-automation="manual">
                        <input type="radio" name="automation" id="autoManual" value="manual">
                        <label for="autoManual">
                            <div class="mode-title">
                                <i class="bi bi-eye"></i>
                                Manual (View Only)
                            </div>
                            <div class="mode-desc">View AI decisions, no execution. Use for learning and observation.</div>
                        </label>
                    </div>
                    <div class="mode-option" data-automation="semi_automated">
                        <input type="radio" name="automation" id="autoSemiAuto" value="semi_automated">
                        <label for="autoSemiAuto">
                            <div class="mode-title">
                                <i class="bi bi-hand-thumbs-up"></i>
                                Semi-Automated (Review & Approve)
                            </div>
                            <div class="mode-desc">Review and approve each AI decision before execution. You stay in control.</div>
                        </label>
                    </div>
                    <div class="mode-option" data-automation="fully_automated">
                        <input type="radio" name="automation" id="autoFullAuto" value="fully_automated">
                        <label for="autoFullAuto">
                            <div class="mode-title">
                                <i class="bi bi-lightning-charge-fill"></i>
                                Fully Automated (Autonomous)
                            </div>
                            <div class="mode-desc">ü§ñ AI trades automatically after risk checks. Use only when fully ready.</div>
                        </label>
                    </div>
                </div>
            </div>

        </div>

        <!-- Page: Models -->
        <div class="page" id="modelsPage">
            <!-- Multi-Model Control -->
            <div class="section">
                <div class="section-header">
                    <h2>ü§ñ Trading Models Management</h2>
                    <button class="btn-primary" onclick="switchPage('settings'); setTimeout(() => document.getElementById('addModelBtn').click(), 100)">
                        <i class="bi bi-plus-circle"></i> Create New Model
                    </button>
                </div>

                <!-- Info: Models always trade independently -->
                <div class="info-banner">
                    <i class="bi bi-info-circle"></i>
                    <span>All models operate independently with their own trading environments and automation settings.</span>
                </div>
            </div>

            <!-- Aggregated Performance -->
            <div class="section" id="aggregatedSection" style="display: none;">
                <div class="section-header">
                    <h2>üìä Aggregated Performance</h2>
                </div>
                <div class="aggregated-metrics">
                    <div class="agg-metric-card">
                        <div class="agg-metric-label">Total Capital</div>
                        <div class="agg-metric-value" id="aggTotalCapital">$0.00</div>
                    </div>
                    <div class="agg-metric-card">
                        <div class="agg-metric-label">Combined Value</div>
                        <div class="agg-metric-value" id="aggTotalValue">$0.00</div>
                    </div>
                    <div class="agg-metric-card">
                        <div class="agg-metric-label">Combined P&L</div>
                        <div class="agg-metric-value" id="aggTotalPnL">$0.00</div>
                        <div class="agg-metric-change" id="aggTotalPnLPercent">--</div>
                    </div>
                    <div class="agg-metric-card">
                        <div class="agg-metric-label">Active Models</div>
                        <div class="agg-metric-value" id="aggActiveModels">0/0</div>
                    </div>
                    <div class="agg-metric-card">
                        <div class="agg-metric-label">Total Trades</div>
                        <div class="agg-metric-value" id="aggTotalTrades">0</div>
                    </div>
                    <div class="agg-metric-card">
                        <div class="agg-metric-label">Avg Win Rate</div>
                        <div class="agg-metric-value" id="aggAvgWinRate">0%</div>
                    </div>
                </div>
            </div>

            <!-- Models Grid -->
            <div class="section">
                <div class="section-header">
                    <h2>Your Trading Models</h2>
                    <div class="models-filter">
                        <select id="modelsFilter" class="form-select-small">
                            <option value="all">All Models</option>
                            <option value="active">Active Only</option>
                            <option value="paused">Paused Only</option>
                        </select>
                    </div>
                </div>
                <div class="models-grid" id="modelsGrid">
                    <div class="empty-state">
                        <i class="bi bi-cpu"></i>
                        <p>No models created yet</p>
                        <button class="btn-primary" onclick="switchPage('settings'); setTimeout(() => document.getElementById('addModelBtn').click(), 100)">
                            Create Your First Model
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page: Settings -->
        <div class="page" id="settingsPage">
            <!-- AI Provider Configuration -->
            <div class="section">
                <div class="section-header">
                    <h2>AI Provider Configuration</h2>
                    <span class="help-icon" title="Configure AI providers (OpenRouter, OpenAI, etc.) for making trading decisions">
                        <i class="bi bi-question-circle"></i>
                    </span>
                </div>

                <!-- Provider List -->
                <div class="provider-list" id="providerList">
                    <div class="empty-state">
                        <i class="bi bi-robot"></i>
                        <p>No AI providers configured. Add one to get started.</p>
                    </div>
                </div>

                <!-- Add Provider Button -->
                <button class="btn-primary" id="addProviderBtn">
                    <i class="bi bi-plus-circle"></i>
                    Add AI Provider
                </button>
            </div>

            <!-- Model Configuration -->
            <div class="section">
                <div class="section-header">
                    <h2>Trading Models</h2>
                    <span class="help-icon" title="Create and configure trading models. Each model uses an AI provider to make decisions.">
                        <i class="bi bi-question-circle"></i>
                    </span>
                </div>

                <!-- Model List -->
                <div class="model-list-config" id="modelListConfig">
                    <div class="empty-state">
                        <i class="bi bi-cpu"></i>
                        <p>No models configured. Add an AI provider first, then create a model.</p>
                    </div>
                </div>

                <!-- Add Model Button -->
                <button class="btn-primary" id="addModelBtn">
                    <i class="bi bi-plus-circle"></i>
                    Create New Model
                </button>
            </div>

            <div class="section">
                <div class="section-header">
                    <h2>Risk Profile Presets</h2>
                    <span class="help-icon" title="Quick-switch between pre-configured risk settings">
                        <i class="bi bi-question-circle"></i>
                    </span>
                </div>
                <div class="risk-profiles-container" id="riskProfilesContainer">
                    <div class="profiles-grid" id="profilesGrid">
                        <!-- Profiles will be loaded here -->
                    </div>
                    <div class="profile-actions">
                        <button class="btn-secondary" id="createCustomProfileBtn">
                            <i class="bi bi-plus-circle"></i>
                            Create Custom Profile
                        </button>
                        <button class="btn-secondary" id="compareProfilesBtn">
                            <i class="bi bi-bar-chart"></i>
                            Compare Profiles
                        </button>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <h2>Risk Management Settings</h2>
                    <span class="profile-indicator" id="activeProfileIndicator" style="display: none;">
                        <i class="bi bi-bookmark-fill"></i>
                        <span id="activeProfileName"></span>
                    </span>
                </div>
                <div class="settings-form" id="settingsForm">
                    <div class="form-group">
                        <label>
                            Max Position Size (%)
                            <span class="help-icon" title="Maximum % of portfolio in a single position">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <input type="number" id="maxPositionSizePct" class="form-input" step="0.1" min="1" max="50">
                    </div>

                    <div class="form-group">
                        <label>
                            Max Daily Loss (%)
                            <span class="help-icon" title="Circuit breaker: trading stops if daily loss exceeds this">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <input type="number" id="maxDailyLossPct" class="form-input" step="0.1" min="0.5" max="20">
                    </div>

                    <div class="form-group">
                        <label>
                            Max Daily Trades
                            <span class="help-icon" title="Maximum number of trades per day">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <input type="number" id="maxDailyTrades" class="form-input" min="1" max="100">
                    </div>

                    <div class="form-group">
                        <label>
                            Max Open Positions
                            <span class="help-icon" title="Maximum simultaneous open positions">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <input type="number" id="maxOpenPositions" class="form-input" min="1" max="20">
                    </div>

                    <div class="form-group">
                        <label>
                            Min Cash Reserve (%)
                            <span class="help-icon" title="Minimum % of portfolio to keep in cash">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <input type="number" id="minCashReservePct" class="form-input" step="1" min="10" max="80">
                    </div>

                    <div class="form-group">
                        <label>
                            Max Drawdown (%) - Full Auto Only
                            <span class="help-icon" title="Auto-pause if portfolio drops this much from peak">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <input type="number" id="maxDrawdownPct" class="form-input" step="1" min="5" max="50">
                    </div>

                    <div class="form-group">
                        <label>
                            Trading Interval (minutes)
                            <span class="help-icon" title="How often to check for trading opportunities">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <input type="number" id="tradingIntervalMinutes" class="form-input" min="5" max="1440">
                    </div>

                    <div class="form-actions">
                        <button class="btn-primary" id="saveSettingsBtn">
                            <i class="bi bi-save"></i>
                            Save Settings
                        </button>
                        <button class="btn-secondary" id="resetSettingsBtn">
                            <i class="bi bi-arrow-counterclockwise"></i>
                            Reset to Defaults
                        </button>
                    </div>
                </div>
            </div>

            <!-- Exchange Configuration -->
            <div class="section">
                <div class="section-header">
                    <h2>Exchange Configuration</h2>
                    <span class="help-icon" title="Configure Binance API credentials for live trading">
                        <i class="bi bi-question-circle"></i>
                    </span>
                </div>

                <!-- Exchange Status -->
                <div class="exchange-status-card" id="exchangeStatusCard">
                    <div class="status-row">
                        <span class="status-label">Exchange Connection:</span>
                        <span class="status-indicator" id="exchangeStatusIndicator">
                            <i class="bi bi-circle-fill"></i>
                            <span id="exchangeStatusText">Not Configured</span>
                        </span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">Mainnet Credentials:</span>
                        <span class="status-badge" id="mainnetStatusBadge">Not Set</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">Testnet Credentials:</span>
                        <span class="status-badge" id="testnetStatusBadge">Not Set</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">Last Validated:</span>
                        <span class="status-text" id="lastValidatedText">Never</span>
                    </div>
                </div>

                <!-- Exchange Environment Selector -->
                <div class="form-group">
                    <label class="form-label-important">
                        <i class="bi bi-server"></i>
                        Exchange Environment
                        <span class="help-icon" title="Select Testnet for safe testing, Mainnet for real trading">
                            <i class="bi bi-question-circle"></i>
                        </span>
                    </label>
                    <div class="exchange-env-selector">
                        <div class="env-option" data-env="testnet">
                            <input type="radio" name="exchangeEnv" id="exchangeEnvTestnet" value="testnet" checked>
                            <label for="exchangeEnvTestnet">
                                <i class="bi bi-shield-check"></i>
                                <strong>Testnet</strong>
                                <span class="env-desc">Safe testing environment (recommended)</span>
                            </label>
                        </div>
                        <div class="env-option" data-env="mainnet">
                            <input type="radio" name="exchangeEnv" id="exchangeEnvMainnet" value="mainnet">
                            <label for="exchangeEnvMainnet">
                                <i class="bi bi-exclamation-triangle-fill"></i>
                                <strong>Mainnet</strong>
                                <span class="env-desc">REAL MONEY - Use with extreme caution!</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Credentials Form -->
                <div class="credentials-form" id="credentialsForm">
                    <div class="form-section-header">
                        <h3>
                            <i class="bi bi-key"></i>
                            Binance API Credentials
                        </h3>
                        <p class="form-section-desc">
                            Get your API keys from
                            <a href="https://testnet.binance.vision/" target="_blank">Binance Testnet</a> (for testing) or
                            <a href="https://www.binance.com/en/my/settings/api-management" target="_blank">Binance</a> (for live trading)
                        </p>
                    </div>

                    <!-- Testnet Credentials -->
                    <div class="credentials-section">
                        <h4 class="credentials-section-title">
                            <i class="bi bi-shield-check"></i>
                            Testnet Credentials (Safe Testing)
                        </h4>

                        <div class="form-group">
                            <label>Testnet API Key</label>
                            <input type="text" id="testnetApiKey" class="form-input" placeholder="Enter testnet API key">
                        </div>

                        <div class="form-group">
                            <label>Testnet API Secret</label>
                            <div class="input-with-toggle">
                                <input type="password" id="testnetApiSecret" class="form-input" placeholder="Enter testnet API secret">
                                <button class="toggle-visibility" data-target="testnetApiSecret" title="Show/Hide">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Mainnet Credentials -->
                    <div class="credentials-section warning-section">
                        <h4 class="credentials-section-title">
                            <i class="bi bi-exclamation-triangle-fill"></i>
                            Mainnet Credentials (REAL MONEY)
                        </h4>

                        <div class="warning-box">
                            <i class="bi bi-exclamation-triangle"></i>
                            <div>
                                <strong>Warning:</strong> Mainnet credentials control real funds.
                                Only enter these if you intend to trade with real money.
                                Always test thoroughly on Testnet first!
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Mainnet API Key</label>
                            <input type="text" id="mainnetApiKey" class="form-input" placeholder="Enter mainnet API key">
                        </div>

                        <div class="form-group">
                            <label>Mainnet API Secret</label>
                            <div class="input-with-toggle">
                                <input type="password" id="mainnetApiSecret" class="form-input" placeholder="Enter mainnet API secret">
                                <button class="toggle-visibility" data-target="mainnetApiSecret" title="Show/Hide">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="form-actions">
                        <button class="btn-primary" id="saveCredentialsBtn">
                            <i class="bi bi-save"></i>
                            Save Credentials
                        </button>
                        <button class="btn-secondary" id="validateCredentialsBtn">
                            <i class="bi bi-check-circle"></i>
                            Validate Connection
                        </button>
                        <button class="btn-danger" id="deleteCredentialsBtn">
                            <i class="bi bi-trash"></i>
                            Delete Credentials
                        </button>
                    </div>
                </div>

                <!-- Security Notice -->
                <div class="info-box">
                    <i class="bi bi-info-circle"></i>
                    <div>
                        <strong>Security Note:</strong> Your API keys are stored in the local database.
                        For production use, ensure your database is encrypted and secured.
                        Never share your API keys with anyone.
                    </div>
                </div>
            </div>
        </div>

        <!-- Page: Readiness -->
        <div class="page" id="readinessPage">
            <div class="section">
                <div class="section-header">
                    <h2>Full Automation Readiness</h2>
                </div>
                <div class="readiness-container">
                    <div class="readiness-score">
                        <div class="score-circle" id="scoreCircle">
                            <div class="score-value" id="scoreValue">--</div>
                            <div class="score-max">/100</div>
                        </div>
                        <div class="score-message" id="scoreMessage">Loading...</div>
                    </div>

                    <div class="readiness-metrics">
                        <h3>Performance Metrics</h3>
                        <div class="metric-item">
                            <div class="metric-label">Total Trades</div>
                            <div class="metric-value" id="metricTotalTrades">--</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Win Rate</div>
                            <div class="metric-value" id="metricWinRate">--</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Approval Rate</div>
                            <div class="metric-value" id="metricApprovalRate">--</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Modification Rate</div>
                            <div class="metric-value" id="metricModificationRate">--</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Risk Violations</div>
                            <div class="metric-value" id="metricRiskViolations">--</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Total Return</div>
                            <div class="metric-value" id="metricTotalReturn">--</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Return Volatility</div>
                            <div class="metric-value" id="metricReturnVolatility">--</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page: Incidents -->
        <div class="page" id="incidentsPage">
            <div class="section">
                <div class="section-header">
                    <h2>Incident Log</h2>
                    <button class="btn-secondary" id="refreshIncidentsBtn">
                        <i class="bi bi-arrow-clockwise"></i>
                        Refresh
                    </button>
                </div>
                <div class="incidents-container" id="incidentsContainer">
                    <div class="empty-state">
                        <i class="bi bi-shield-check"></i>
                        <p>No incidents</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Live Environment Warning Modal -->
    <div class="modal" id="liveWarningModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="bi bi-exclamation-triangle-fill" style="color: var(--color-danger);"></i>
                    Switch to Live Trading?
                </h3>
            </div>
            <div class="modal-body">
                <p style="font-size: 16px; margin-bottom: 16px;">
                    <strong>‚ö†Ô∏è WARNING: You are about to switch to LIVE TRADING mode.</strong>
                </p>
                <p style="margin-bottom: 12px;">This means:</p>
                <ul style="margin-left: 20px; margin-bottom: 16px;">
                    <li>Trades will execute on a REAL exchange</li>
                    <li>REAL MONEY will be at risk</li>
                    <li>Losses can and will happen</li>
                    <li>You are responsible for all trades</li>
                </ul>
                <p style="margin-bottom: 16px;">
                    <strong>Before proceeding, ensure:</strong>
                </p>
                <ul style="margin-left: 20px; margin-bottom: 16px;">
                    <li>‚úì You have tested extensively in Simulation mode</li>
                    <li>‚úì You understand the risks involved</li>
                    <li>‚úì Your risk management settings are appropriate</li>
                    <li>‚úì You are using testnet first (not mainnet)</li>
                    <li>‚úì You can afford to lose the capital allocated</li>
                </ul>
                <p style="color: var(--color-danger); font-weight: 600;">
                    Are you absolutely sure you want to proceed?
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelLiveBtn">
                    <i class="bi bi-x-circle"></i>
                    No, Stay in Simulation
                </button>
                <button class="btn-danger" id="confirmLiveBtn">
                    <i class="bi bi-check-circle"></i>
                    Yes, Switch to Live
                </button>
            </div>
        </div>
    </div>

    <!-- Decision Detail Modal -->
    <div class="modal" id="decisionModal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>
                    <i class="bi bi-graph-up-arrow"></i>
                    AI Trading Decision
                </h3>
                <button class="btn-close" id="closeDecisionModal">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="modal-body" id="decisionModalBody">
                <!-- Decision details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button class="btn-danger" id="rejectDecisionBtn">
                    <i class="bi bi-x-circle"></i>
                    Reject
                </button>
                <button class="btn-warning" id="modifyDecisionBtn">
                    <i class="bi bi-pencil"></i>
                    Modify & Approve
                </button>
                <button class="btn-success" id="approveDecisionBtn">
                    <i class="bi bi-check-circle"></i>
                    Approve
                </button>
            </div>
        </div>
    </div>

    <!-- Provider Modal -->
    <div class="modal" id="providerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="bi bi-robot"></i>
                    <span id="providerModalTitle">Add AI Provider</span>
                </h3>
                <button class="btn-close" id="closeProviderModal">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="providerForm">
                    <input type="hidden" id="providerIdField">

                    <div class="form-group">
                        <label>Provider Name *</label>
                        <input type="text" id="providerName" class="form-input" placeholder="e.g., OpenRouter, OpenAI" required>
                    </div>

                    <div class="form-group">
                        <label>
                            API URL *
                            <span class="help-icon" title="Base URL for API (e.g., https://openrouter.ai/api/v1 or https://api.openai.com/v1)">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <input type="url" id="providerApiUrl" class="form-input" placeholder="https://api.example.com/v1" required>
                    </div>

                    <div class="form-group">
                        <label>
                            API Key *
                            <span class="help-icon" title="Your API key from the provider">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <div class="input-with-toggle">
                            <input type="password" id="providerApiKey" class="form-input" placeholder="sk-..." required>
                            <button type="button" class="toggle-visibility" data-target="providerApiKey" title="Show/Hide">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            Available Models (comma-separated)
                            <span class="help-icon" title="Optional: List of model IDs available from this provider">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <textarea id="providerModels" class="form-input" rows="3" placeholder="e.g., gpt-4-turbo,gpt-4,anthropic/claude-3.5-sonnet"></textarea>
                    </div>
                </form>

                <div class="info-box" style="margin-top: 16px;">
                    <i class="bi bi-info-circle"></i>
                    <div>
                        <strong>Quick Setup:</strong><br>
                        <strong>OpenRouter:</strong> URL: <code>https://openrouter.ai/api/v1</code><br>
                        <strong>OpenAI:</strong> URL: <code>https://api.openai.com/v1</code>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancelProviderBtn">
                    <i class="bi bi-x-circle"></i>
                    Cancel
                </button>
                <button type="button" class="btn-primary" id="saveProviderBtn">
                    <i class="bi bi-save"></i>
                    Save Provider
                </button>
            </div>
        </div>
    </div>

    <!-- Model Modal -->
    <div class="modal" id="modelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="bi bi-cpu"></i>
                    <span id="modelModalTitle">Create Trading Model</span>
                </h3>
                <button class="btn-close" id="closeModelModal">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="modelForm">
                    <input type="hidden" id="modelIdField">

                    <div class="form-group">
                        <label>Model Name *</label>
                        <input type="text" id="modelName" class="form-input" placeholder="e.g., Conservative Strategy" required>
                    </div>

                    <div class="form-group">
                        <label>
                            AI Provider *
                            <span class="help-icon" title="Select which AI provider this model will use">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <select id="modelProvider" class="form-select" required>
                            <option value="">Select a provider...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>
                            AI Model *
                            <span class="help-icon" title="Select which AI model to use (e.g., gpt-4, claude-3.5-sonnet). Click 'Load Models' to fetch available models from your selected provider.">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <div style="display: flex; gap: 8px;">
                            <input type="text" id="modelAiModel" class="form-input" list="availableModelsList" placeholder="e.g., gpt-4-turbo, anthropic/claude-3.5-sonnet" required style="flex: 1;">
                            <button type="button" class="btn-secondary" id="loadModelsBtn" style="white-space: nowrap;">
                                <i class="bi bi-cloud-download"></i>
                                Load Models
                            </button>
                        </div>
                        <datalist id="availableModelsList">
                        </datalist>
                        <small class="form-help" id="modelLoadStatus" style="display: none; color: var(--color-success);"></small>
                    </div>

                    <div class="form-group">
                        <label>
                            Initial Capital
                            <span class="help-icon" title="Starting capital for this model (simulation only)">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <input type="number" id="modelCapital" class="form-input" value="100000" min="1000" step="1000" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancelModelBtn">
                    <i class="bi bi-x-circle"></i>
                    Cancel
                </button>
                <button type="button" class="btn-primary" id="saveModelBtn">
                    <i class="bi bi-save"></i>
                    Save Model
                </button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div class="toast" id="toast">
        <div class="toast-content">
            <i class="bi bi-info-circle"></i>
            <span id="toastMessage">Notification</span>
        </div>
    </div>

    <script src="/static/notifications.js"></script>
    <script src="/static/exports.js"></script>
    <script src="/static/decision-history.js"></script>
    <script src="/static/activity-feed.js"></script>
    <script src="/static/enhanced.js"></script>
    <script src="/static/risk_profiles.js"></script>
</body>
</html>
