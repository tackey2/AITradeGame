<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Trading System - Enhanced Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/enhanced.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="app-title">
                        <i class="bi bi-robot"></i>
                        Personal Trading System
                    </h1>
                    <div class="mode-badge" id="currentModeBadge">
                        <span class="mode-icon">‚óè</span>
                        <span id="currentEnvironmentText">Simulation</span>
                        <span class="mode-separator">|</span>
                        <span id="currentAutomationText">Manual</span>
                    </div>
                </div>
                <div class="header-right">
                    <button class="btn-icon" id="refreshBtn" title="Refresh">
                        <i class="bi bi-arrow-clockwise"></i>
                    </button>
                    <button class="btn-emergency" id="emergencyStopBtn" title="Emergency Stop All">
                        <i class="bi bi-octagon-fill"></i>
                        STOP
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="app-nav">
            <button class="nav-btn active" data-page="dashboard">
                <i class="bi bi-speedometer2"></i>
                <span>Dashboard</span>
            </button>
            <button class="nav-btn" data-page="settings">
                <i class="bi bi-sliders"></i>
                <span>Settings</span>
            </button>
            <button class="nav-btn" data-page="readiness">
                <i class="bi bi-check-circle"></i>
                <span>Readiness</span>
            </button>
            <button class="nav-btn" data-page="incidents">
                <i class="bi bi-exclamation-triangle"></i>
                <span>Incidents</span>
            </button>
            <a href="/" class="nav-btn">
                <i class="bi bi-grid"></i>
                <span>Classic View</span>
            </a>
        </nav>

        <!-- Page: Dashboard -->
        <div class="page active" id="dashboardPage">
            <!-- Model Selector -->
            <div class="section">
                <div class="section-header">
                    <h2>Select Model</h2>
                </div>
                <div class="model-selector">
                    <select id="modelSelect" class="form-select">
                        <option value="">Loading models...</option>
                    </select>
                </div>
            </div>

            <!-- Trading Environment -->
            <div class="section">
                <div class="section-header">
                    <h2>Trading Environment</h2>
                    <span class="help-icon" title="WHERE trades are executed - simulation or live exchange">
                        <i class="bi bi-question-circle"></i>
                    </span>
                </div>
                <div class="mode-control">
                    <div class="mode-option" data-environment="simulation">
                        <input type="radio" name="environment" id="envSimulation" value="simulation">
                        <label for="envSimulation">
                            <div class="mode-title">
                                <i class="bi bi-laptop"></i>
                                Simulation (Paper Trading)
                            </div>
                            <div class="mode-desc">Practice with virtual money. Database only, no real exchange API calls.</div>
                        </label>
                    </div>
                    <div class="mode-option" data-environment="live">
                        <input type="radio" name="environment" id="envLive" value="live">
                        <label for="envLive">
                            <div class="mode-title">
                                <i class="bi bi-broadcast"></i>
                                Live Trading
                            </div>
                            <div class="mode-desc">‚ö†Ô∏è REAL MONEY - Executes on real exchange (testnet or mainnet).</div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Automation Level -->
            <div class="section">
                <div class="section-header">
                    <h2>Automation Level</h2>
                    <span class="help-icon" title="HOW much control you have - manual, semi-auto, or full-auto">
                        <i class="bi bi-question-circle"></i>
                    </span>
                </div>
                <div class="mode-control">
                    <div class="mode-option" data-automation="manual">
                        <input type="radio" name="automation" id="autoManual" value="manual">
                        <label for="autoManual">
                            <div class="mode-title">
                                <i class="bi bi-eye"></i>
                                Manual (View Only)
                            </div>
                            <div class="mode-desc">View AI decisions, no execution. Use for learning and observation.</div>
                        </label>
                    </div>
                    <div class="mode-option" data-automation="semi_automated">
                        <input type="radio" name="automation" id="autoSemiAuto" value="semi_automated">
                        <label for="autoSemiAuto">
                            <div class="mode-title">
                                <i class="bi bi-hand-thumbs-up"></i>
                                Semi-Automated (Review & Approve)
                            </div>
                            <div class="mode-desc">Review and approve each AI decision before execution. You stay in control.</div>
                        </label>
                    </div>
                    <div class="mode-option" data-automation="fully_automated">
                        <input type="radio" name="automation" id="autoFullAuto" value="fully_automated">
                        <label for="autoFullAuto">
                            <div class="mode-title">
                                <i class="bi bi-lightning-charge-fill"></i>
                                Fully Automated (Autonomous)
                            </div>
                            <div class="mode-desc">ü§ñ AI trades automatically after risk checks. Use only when fully ready.</div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Risk Status -->
            <div class="section">
                <div class="section-header">
                    <h2>Risk Status</h2>
                </div>
                <div class="risk-grid" id="riskGrid">
                    <div class="risk-card">
                        <div class="risk-label">Position Size</div>
                        <div class="risk-value" id="riskPositionSize">--</div>
                        <div class="risk-status status-ok" id="statusPositionSize">OK</div>
                    </div>
                    <div class="risk-card">
                        <div class="risk-label">Daily Loss</div>
                        <div class="risk-value" id="riskDailyLoss">--</div>
                        <div class="risk-status status-ok" id="statusDailyLoss">OK</div>
                    </div>
                    <div class="risk-card">
                        <div class="risk-label">Open Positions</div>
                        <div class="risk-value" id="riskOpenPositions">--</div>
                        <div class="risk-status status-ok" id="statusOpenPositions">OK</div>
                    </div>
                    <div class="risk-card">
                        <div class="risk-label">Cash Reserve</div>
                        <div class="risk-value" id="riskCashReserve">--</div>
                        <div class="risk-status status-ok" id="statusCashReserve">OK</div>
                    </div>
                    <div class="risk-card">
                        <div class="risk-label">Daily Trades</div>
                        <div class="risk-value" id="riskDailyTrades">--</div>
                        <div class="risk-status status-ok" id="statusDailyTrades">OK</div>
                    </div>
                </div>
            </div>

            <!-- Pending Decisions -->
            <div class="section">
                <div class="section-header">
                    <h2>Pending Decisions</h2>
                    <span class="badge" id="pendingCount">0</span>
                </div>
                <div id="pendingDecisionsContainer">
                    <div class="empty-state">
                        <i class="bi bi-inbox"></i>
                        <p>No pending decisions</p>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="section">
                <div class="section-header">
                    <h2>Actions</h2>
                </div>
                <div class="action-buttons">
                    <button class="btn-primary" id="executeTradingBtn">
                        <i class="bi bi-play-circle"></i>
                        Execute Trading Cycle
                    </button>
                    <button class="btn-secondary" id="pauseModelBtn">
                        <i class="bi bi-pause-circle"></i>
                        Emergency Pause
                    </button>
                </div>
            </div>
        </div>

        <!-- Page: Settings -->
        <div class="page" id="settingsPage">
            <div class="section">
                <div class="section-header">
                    <h2>Risk Management Settings</h2>
                </div>
                <div class="settings-form" id="settingsForm">
                    <div class="form-group">
                        <label>
                            Max Position Size (%)
                            <span class="help-icon" title="Maximum % of portfolio in a single position">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <input type="number" id="maxPositionSizePct" class="form-input" step="0.1" min="1" max="50">
                    </div>

                    <div class="form-group">
                        <label>
                            Max Daily Loss (%)
                            <span class="help-icon" title="Circuit breaker: trading stops if daily loss exceeds this">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <input type="number" id="maxDailyLossPct" class="form-input" step="0.1" min="0.5" max="20">
                    </div>

                    <div class="form-group">
                        <label>
                            Max Daily Trades
                            <span class="help-icon" title="Maximum number of trades per day">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <input type="number" id="maxDailyTrades" class="form-input" min="1" max="100">
                    </div>

                    <div class="form-group">
                        <label>
                            Max Open Positions
                            <span class="help-icon" title="Maximum simultaneous open positions">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <input type="number" id="maxOpenPositions" class="form-input" min="1" max="20">
                    </div>

                    <div class="form-group">
                        <label>
                            Min Cash Reserve (%)
                            <span class="help-icon" title="Minimum % of portfolio to keep in cash">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <input type="number" id="minCashReservePct" class="form-input" step="1" min="10" max="80">
                    </div>

                    <div class="form-group">
                        <label>
                            Max Drawdown (%) - Full Auto Only
                            <span class="help-icon" title="Auto-pause if portfolio drops this much from peak">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <input type="number" id="maxDrawdownPct" class="form-input" step="1" min="5" max="50">
                    </div>

                    <div class="form-group">
                        <label>
                            Trading Interval (minutes)
                            <span class="help-icon" title="How often to check for trading opportunities">
                                <i class="bi bi-question-circle"></i>
                            </span>
                        </label>
                        <input type="number" id="tradingIntervalMinutes" class="form-input" min="5" max="1440">
                    </div>

                    <div class="form-actions">
                        <button class="btn-primary" id="saveSettingsBtn">
                            <i class="bi bi-save"></i>
                            Save Settings
                        </button>
                        <button class="btn-secondary" id="resetSettingsBtn">
                            <i class="bi bi-arrow-counterclockwise"></i>
                            Reset to Defaults
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page: Readiness -->
        <div class="page" id="readinessPage">
            <div class="section">
                <div class="section-header">
                    <h2>Full Automation Readiness</h2>
                </div>
                <div class="readiness-container">
                    <div class="readiness-score">
                        <div class="score-circle" id="scoreCircle">
                            <div class="score-value" id="scoreValue">--</div>
                            <div class="score-max">/100</div>
                        </div>
                        <div class="score-message" id="scoreMessage">Loading...</div>
                    </div>

                    <div class="readiness-metrics">
                        <h3>Performance Metrics</h3>
                        <div class="metric-item">
                            <div class="metric-label">Total Trades</div>
                            <div class="metric-value" id="metricTotalTrades">--</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Win Rate</div>
                            <div class="metric-value" id="metricWinRate">--</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Approval Rate</div>
                            <div class="metric-value" id="metricApprovalRate">--</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Modification Rate</div>
                            <div class="metric-value" id="metricModificationRate">--</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Risk Violations</div>
                            <div class="metric-value" id="metricRiskViolations">--</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Total Return</div>
                            <div class="metric-value" id="metricTotalReturn">--</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Return Volatility</div>
                            <div class="metric-value" id="metricReturnVolatility">--</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page: Incidents -->
        <div class="page" id="incidentsPage">
            <div class="section">
                <div class="section-header">
                    <h2>Incident Log</h2>
                    <button class="btn-secondary" id="refreshIncidentsBtn">
                        <i class="bi bi-arrow-clockwise"></i>
                        Refresh
                    </button>
                </div>
                <div class="incidents-container" id="incidentsContainer">
                    <div class="empty-state">
                        <i class="bi bi-shield-check"></i>
                        <p>No incidents</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Live Environment Warning Modal -->
    <div class="modal" id="liveWarningModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="bi bi-exclamation-triangle-fill" style="color: var(--color-danger);"></i>
                    Switch to Live Trading?
                </h3>
            </div>
            <div class="modal-body">
                <p style="font-size: 16px; margin-bottom: 16px;">
                    <strong>‚ö†Ô∏è WARNING: You are about to switch to LIVE TRADING mode.</strong>
                </p>
                <p style="margin-bottom: 12px;">This means:</p>
                <ul style="margin-left: 20px; margin-bottom: 16px;">
                    <li>Trades will execute on a REAL exchange</li>
                    <li>REAL MONEY will be at risk</li>
                    <li>Losses can and will happen</li>
                    <li>You are responsible for all trades</li>
                </ul>
                <p style="margin-bottom: 16px;">
                    <strong>Before proceeding, ensure:</strong>
                </p>
                <ul style="margin-left: 20px; margin-bottom: 16px;">
                    <li>‚úì You have tested extensively in Simulation mode</li>
                    <li>‚úì You understand the risks involved</li>
                    <li>‚úì Your risk management settings are appropriate</li>
                    <li>‚úì You are using testnet first (not mainnet)</li>
                    <li>‚úì You can afford to lose the capital allocated</li>
                </ul>
                <p style="color: var(--color-danger); font-weight: 600;">
                    Are you absolutely sure you want to proceed?
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelLiveBtn">
                    <i class="bi bi-x-circle"></i>
                    No, Stay in Simulation
                </button>
                <button class="btn-danger" id="confirmLiveBtn">
                    <i class="bi bi-check-circle"></i>
                    Yes, Switch to Live
                </button>
            </div>
        </div>
    </div>

    <!-- Decision Detail Modal -->
    <div class="modal" id="decisionModal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>
                    <i class="bi bi-graph-up-arrow"></i>
                    AI Trading Decision
                </h3>
                <button class="btn-close" id="closeDecisionModal">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="modal-body" id="decisionModalBody">
                <!-- Decision details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button class="btn-danger" id="rejectDecisionBtn">
                    <i class="bi bi-x-circle"></i>
                    Reject
                </button>
                <button class="btn-warning" id="modifyDecisionBtn">
                    <i class="bi bi-pencil"></i>
                    Modify & Approve
                </button>
                <button class="btn-success" id="approveDecisionBtn">
                    <i class="bi bi-check-circle"></i>
                    Approve
                </button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div class="toast" id="toast">
        <div class="toast-content">
            <i class="bi bi-info-circle"></i>
            <span id="toastMessage">Notification</span>
        </div>
    </div>

    <script src="/static/enhanced.js"></script>
</body>
</html>
